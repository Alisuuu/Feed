<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main id="news-container">
        <p>Carregando notícias...</p>
    </main>

    <script>
        async function fetchNews() {
            const newsContainer = document.getElementById('news-container');
            newsContainer.innerHTML = '<p>Carregando notícias...</p>'; // Limpa e mostra carregando

            try {
                // Chama a função serverless
                const response = await fetch('/api/news');
                const data = await response.json();

                if (data.articles && data.articles.length > 0) {
                    newsContainer.innerHTML = ''; // Limpa a mensagem de carregamento
                    data.articles.forEach(article => {
                        const articleElement = document.createElement('article');
                        articleElement.classList.add('news-item');

                        // Adiciona a imagem se existir
                        if (article.urlToImage) {
                            const img = document.createElement('img');
                            img.src = article.urlToImage;
                            img.alt = article.title || 'Imagem da notícia'; // Adiciona alt com fallback
                            img.loading = 'lazy'; // Carregamento preguiçoso para performance
                            articleElement.appendChild(img);
                        }

                        const contentDiv = document.createElement('div');
                        contentDiv.classList.add('news-content');

                        // Título da notícia
                        const title = document.createElement('h2');
                        const link = document.createElement('a');
                        link.href = article.url;
                        link.target = "_blank"; // Abre em nova aba
                        link.textContent = article.title;
                        title.appendChild(link);
                        contentDiv.appendChild(title);

                        // Adiciona o resumo (descrição) ou trecho do conteúdo
                        if (article.description) {
                            const description = document.createElement('p');
                            description.textContent = article.description;
                            contentDiv.appendChild(description);
                        } else if (article.content) {
                             // Se não houver descrição, usa o conteúdo e trunca se necessário
                             const contentSnippet = document.createElement('p');
                             // NewsAPI content often ends with "[+XXX chars]". Remove that.
                             const cleanContent = article.content.replace(/\[\+\d+ chars\]$/, '');
                             // Pega os primeiros 150 caracteres (ajuste conforme necessário) e adiciona "..." se for maior
                             const snippetText = cleanContent.length > 150 ? cleanContent.substring(0, 150) + '...' : cleanContent;
                             contentSnippet.textContent = snippetText;
                             contentDiv.appendChild(contentSnippet);
                        }


                        // Adiciona a fonte e data
                        const footer = document.createElement('p');
                        const date = new Date(article.publishedAt).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
                        footer.textContent = `${article.source.name} - ${date}`;
                        contentDiv.appendChild(footer);


                        articleElement.appendChild(contentDiv);
                        newsContainer.appendChild(articleElement);
                    });
                } else {
                    newsContainer.innerHTML = '<p>Nenhuma notícia encontrada no momento.</p>';
                }

            } catch (error) {
                console.error('Erro ao buscar notícias:', error);
                newsContainer.innerHTML = '<p>Ocorreu um erro ao carregar as notícias. Tente novamente mais tarde.</p>';
            }
        }

        // Carrega as notícias quando a página carregar
        window.onload = fetchNews;
    </script>
</body>
</html>
