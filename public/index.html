<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Notícias de Cinema, Filmes e Séries</title>
    <link rel="stylesheet" href="style.css">
    <!-- Adicionando ícone para a busca -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <h1></h1>
        <form id="search-form">
            <input type="text" id="search-input" placeholder="Buscar por filmes, séries, atores...">
            <button type="submit"><i class="fas fa-search"></i></button>
        </form>
    </header>

    <main id="news-container">
        <p class="loading-message">Carregando notícias...</p>
    </main>

    <script>
        const newsContainer = document.getElementById('news-container');
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');

        /**
         * Busca notícias na API com base em uma consulta opcional.
         * @param {string} query - O termo de busca (opcional).
         */
        async function fetchNews(query = '') {
            // Exibe a mensagem de carregamento
            newsContainer.innerHTML = '<p class="loading-message">Carregando notícias...</p>';

            try {
                // Constrói a URL da API, adicionando a query se ela existir
                let apiUrl = '/api/news';
                if (query) {
                    apiUrl += `?q=${encodeURIComponent(query)}`;
                }

                const response = await fetch(apiUrl);
                const data = await response.json();

                // Limpa o contêiner antes de adicionar novos artigos
                newsContainer.innerHTML = '';

                if (data.status === 'ok' && data.articles && data.articles.length > 0) {
                    data.articles.forEach(article => {
                        // Evita renderizar artigos sem título ou imagem
                        if (!article.title || !article.urlToImage) {
                            return;
                        }

                        const articleElement = document.createElement('article');
                        articleElement.classList.add('news-item');

                        const img = document.createElement('img');
                        img.src = article.urlToImage;
                        img.alt = article.title;
                        img.loading = 'lazy'; // Carregamento preguiçoso de imagens
                        // Fallback para imagem padrão em caso de erro
                        img.onerror = function() {
                            this.onerror=null;
                            this.src='default-image.jpg';
                            this.alt='Imagem não disponível';
                        };
                        articleElement.appendChild(img);

                        const contentDiv = document.createElement('div');
                        contentDiv.classList.add('news-content');

                        const title = document.createElement('h2');
                        const link = document.createElement('a');
                        link.href = article.url;
                        link.target = "_blank"; // Abre em nova aba
                        link.rel = "noopener noreferrer"; // Boa prática de segurança
                        link.textContent = article.title;
                        title.appendChild(link);
                        contentDiv.appendChild(title);

                        if (article.description) {
                            const description = document.createElement('p');
                            description.textContent = article.description;
                            contentDiv.appendChild(description);
                        }

                        const footer = document.createElement('p');
                        const date = new Date(article.publishedAt).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
                        footer.textContent = `${article.source.name} - ${date}`;
                        contentDiv.appendChild(footer);

                        articleElement.appendChild(contentDiv);
                        newsContainer.appendChild(articleElement);
                    });
                } else {
                    // Mensagem mais amigável se não encontrar resultados para a busca
                    if(query){
                         newsContainer.innerHTML = `<p class="error-message">Nenhum resultado encontrado para "${query}". Tente um termo diferente.</p>`;
                    } else {
                         newsContainer.innerHTML = '<p class="error-message">Nenhuma notícia encontrada no momento.</p>';
                    }
                }

            } catch (error) {
                console.error('Erro ao buscar notícias:', error);
                newsContainer.innerHTML = '<p class="error-message">Ocorreu um erro ao carregar as notícias. Tente novamente mais tarde.</p>';
            }
        }

        // Adiciona o listener para o evento de submit do formulário de busca
        searchForm.addEventListener('submit', (event) => {
            event.preventDefault(); // Impede o recarregamento da página
            const searchTerm = searchInput.value.trim();
            fetchNews(searchTerm);
        });

        // Carrega as notícias iniciais quando a página é carregada
        window.onload = () => fetchNews();
    </script>
</body>
</html>
