<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Notícias de Cinema, Filmes e Séries</title>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome (para ícones) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CSS Personalizado -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Cabeçalho com efeito de vidro e busca -->
    <header>
        <div class="container">
                   <form id="search-form" class="input-search-wrapper">
                    <input type="text" id="search-input" class="input-search" placeholder="Buscar notícias...">
                    <button type="submit" id="searchButton" aria-label="Buscar"><i class="fas fa-search"></i></button>
                </form>
            </div>
        </div>
    </header>

    <!-- Área de conteúdo principal -->
    <main id="contentArea">
        <div id="news-grid" class="main-results-grid">
            <!-- As notícias serão inseridas aqui pelo JavaScript -->
            <div class="loader"></div>
        </div>
    </main>

    <script>
        const newsGrid = document.getElementById('news-grid');
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');

        /**
         * Busca e exibe as notícias.
         * @param {string} query - O termo de busca (opcional).
         */
        async function fetchNews(query = '') {
            // Exibe o spinner de carregamento
            newsGrid.innerHTML = '<div class="loader"></div>';

            try {
                let apiUrl = '/api/news';
                if (query) {
                    apiUrl += `?q=${encodeURIComponent(query)}`;
                }

                const response = await fetch(apiUrl);
                const data = await response.json();

                // Limpa a grade antes de adicionar novos cards
                newsGrid.innerHTML = '';

                if (data.status === 'ok' && data.articles && data.articles.length > 0) {
                    data.articles.forEach(article => {
                        // Pula artigos que não possuem os dados essenciais
                        if (!article.title || !article.urlToImage || !article.url) {
                            return;
                        }

                        // Cria o card de notícia com a nova estrutura e classes
                        const cardLink = document.createElement('a');
                        cardLink.href = article.url;
                        cardLink.target = "_blank";
                        cardLink.rel = "noopener noreferrer";
                        cardLink.classList.add('content-card');
                        cardLink.setAttribute('aria-label', article.title);

                        const img = document.createElement('img');
                        img.src = article.urlToImage;
                        img.alt = `Capa da notícia: ${article.title}`;
                        img.loading = 'lazy';
                         // Imagem padrão em caso de erro
                        img.onerror = function() {
                            this.onerror = null;
                            this.src = 'https://placehold.co/400x600/121212/F3F4F6?text=Notícia';
                            this.alt = 'Imagem da notícia indisponível';
                        };

                        const titleOverlay = document.createElement('div');
                        titleOverlay.classList.add('title-overlay');

                        const title = document.createElement('h3');
                        title.classList.add('title');
                        title.textContent = article.title;

                        titleOverlay.appendChild(title);
                        cardLink.appendChild(img);
                        cardLink.appendChild(titleOverlay);

                        newsGrid.appendChild(cardLink);
                    });
                } else {
                    // Mensagem de erro ou nenhum resultado
                    let message = query 
                        ? `Nenhum resultado para "${query}".`
                        : "Nenhuma notícia encontrada no momento.";
                    newsGrid.innerHTML = `<p class="error-message">${message}</p>`;
                }

            } catch (error) {
                console.error('Erro ao buscar notícias:', error);
                newsGrid.innerHTML = '<p class="error-message">Ops! Algo deu errado. Tente novamente mais tarde.</p>';
            }
        }

        // Listener para o formulário de busca
        searchForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const searchTerm = searchInput.value.trim();
            fetchNews(searchTerm);
        });

        // Carregamento inicial das notícias
        window.onload = () => fetchNews();
    </script>
</body>
</html>
